<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>File: README.rdoc [Rye: Safely run SSH commands on a bunch of machines at the same time (from Ruby).]</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <link href='../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='file' id='wrapper'>
      <div class='header'>
        <div class='name'>README.rdoc</div>
        <div class='paths'>
          README.rdoc
        </div>
        <div class='last-update'>
          Last Update:
          <span class='datetime'>Wed Apr 29 17:26:41 -0400 2009</span>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <h1><a href="../classes/Rye.html">Rye</a> - v0.6</h1>
            <p>
            Safely run SSH commands on a bunch of machines at the same time (from
            Ruby).
            </p>
            <p>
            <a href="../classes/Rye.html">Rye</a> is similar to <a
            href="http://rush.heroku.com">Rush</a> but everything happens over SSH (no
            HTTP daemon) and the default settings are less powerful (for safety). For
            example, file globs and the &#8220;rm&#8221; command are disabled so unless
            otherwise specified, you can&#8217;t do this: <tt>rbox.rm('-rf',
            '/etc/*<b>/</b>')</tt>.
            </p>
            <h2>Installation</h2>
            <p>
            One of:
            </p>
            <pre>$ sudo gem install rye&#x000A;$ sudo gem install delano-rye --source http://gems.github.com/&#x000A;$ git clone git://github.com/delano/rye.git&#x000A;&#x000A;See bin/try for examples!</pre>
            <h2>EXAMPLE 1 &#8212; SSH Authorization</h2>
            <p>
            Does it annoy you to manually authorize remote SSH accounts? <a
            href="../classes/Rye.html">Rye</a> can help!
            </p>
            <p>
            Enable passwordless logins to HOST1 and HOST2:
            </p>
            <pre>$ rye authorize HOST1 HOST2</pre>
            <p>
            This will copy your public SSH keys to the <tt>~/.ssh/authorized_keys</tt>
            and <tt>~/.ssh/authorized_keys2</tt> files on the remote machine(s).
            </p>
            <p>
            See <tt>rye -h</tt> for more info
            </p>
            <h2>EXAMPLE 2 &#8212; Basic Usage</h2>
            <pre>rbox = Rye::Box.new('localhost')&#x000A;rbox.uptime                        # =&gt; 11:02  up 16:01, 3 users&#x000A;rbox['/usr/bin'].pwd               # =&gt; /usr/bin</pre>
            <p>
            You can specify environment variables
            </p>
            <pre>rbox.setenv(:RYE, &quot;Forty Creek&quot;)&#x000A;rbox.env                           # =&gt; ['HOME=/home/rye', 'RYE=Forty Creek', ...]</pre>
            <h2>EXAMPLE 3 &#8212; Accessing Multiple Machines</h2>
            <pre>rset = Rye::Set.new&#x000A;rbox = Rye::Box.new&#x000A;&#x000A;rset.add_keys('/private/key/path')     # For passwordless logins&#x000A;rset.add_boxes(rbox, 'localhost')      # Add boxes as hostnames or objects</pre>
            <p>
            Calling methods on <a href="../classes/Rye/Set.html">Rye::Set</a> objects
            is very similar to calling them on <a
            href="../classes/Rye/Box.html">Rye::Box</a> objects. In fact, it&#8217;s
            identical:
            </p>
            <pre>p rset.uptime        # =&gt; [[14:19:02 up 32 days, 19:35 ...], [14:19:02 up 30 days, 01:35]]&#x000A;p rset['/etc'].ls    # =&gt; [['file1', 'file2', ...], ['life1', 'life2', ...]]</pre>
            <h2>EXAMPLE 4 &#8212; FILE TRANSFERS</h2>
            <pre>rbox = Rye::Box.new(&quot;localhost&quot;, :info =&gt; true)&#x000A;&#x000A;dir_upload = &quot;#{Rye.sysinfo.tmpdir}/rye-upload/&quot;&#x000A;dir_download = &quot;#{Rye.sysinfo.tmpdir}/rye-download/&quot;&#x000A;&#x000A;rbox.upload(&quot;#{RYE_HOME}/README.rdoc&quot;,&#x000A;            &quot;#{RYE_HOME}/LICENSE.txt&quot;, dir_upload)&#x000A;&#x000A;applejack = StringIO.new(&quot;Some in-memory content&quot;)&#x000A;rbox.upload(applejack, &quot;#{dir_upload}/applejack.txt&quot;)&#x000A;&#x000A;p rbox.ls(dir_upload)            # =&gt; [README.rdoc, LICENSE.txt, applejack.txt]&#x000A;p rbox.cat(&quot;#{dir_upload}/applejack.txt&quot;)   # =&gt; &quot;Some in-memory content&quot;&#x000A;&#x000A;filecontent = StringIO.new&#x000A;rbox.download(&quot;#{dir_upload}/applejack.txt&quot;, filecontent)&#x000A;&#x000A;p filecontent.read</pre>
            <h2>About Safe-Mode</h2>
            <p>
            In safe-mode:
            </p>
            <ul>
            <li>You can&#8217;t use file globs. This means you can&#8217;t do this:
            <tt>rbox.ls('*.rb')</tt>. <tt>~</tt> also doesn&#8217;t work!
            
            </li>
            <li>Command arguments cannot contain environment variables (however,
            environment variables are available to the commands you run). This means
            you can&#8217;t do this: <tt>rbox.echo('$HOME')</tt>.
            
            </li>
            <li>Pipes and operators don&#8217;t work: <tt>|, &amp;&amp;, &gt;, &lt;, ||,
            ~</tt>, etc...
            
            </li>
            <li>Backticks don&#8217;t work either: <tt>procs=`ps aux`</tt>
            
            </li>
            </ul>
            <p>
            Why? In safe-mode, all command arguments are escaped which turns all
            arguments into their literal values.
            </p>
            <p>
            Using a Ruby interface to execute shell commands is pretty awesome,
            particularly to run them on several machines simultaneously. That&#8217;s a
            lot of power and it&#8217;s potentially very dangerous. That&#8217;s why <a
            href="../classes/Rye.html">Rye</a> disables this stuff by default.
            There&#8217;s probably a way to do it safely but it&#8217;s not obvious yet
            (to me). If you have any ideas, I&#8217;d love to hear them!
            </p>
            <h2>Command Whitelist</h2>
            <p>
            <a href="../classes/Rye.html">Rye</a> permits only a limited number of
            system commands to be run. This default whitelist is defined in <a
            href="http://github.com/delano/rye/blob/master/lib/rye/cmd.rb">Rye::Cmd</a>
            but you can add your own commands as you please (see Example 3).
            </p>
            <h2>Dependencies</h2>
            <ul>
            <li><a href="http://www.openssl.org">OpenSSL</a> (The C library)
            
            </li>
            <li>Ruby Gems:
            
            <ul>
            <li>net-ssh
            
            </li>
            <li>net-scp
            
            </li>
            <li>highline
            
            </li>
            <li>drydock
            
            </li>
            </ul>
            </li>
            </ul>
            <h2>Known Issues</h2>
            <p>
            This list will grow. If you find one let me know!
            </p>
            <ul>
            <li><a href="../classes/Rye.html">Rye</a> doesn&#8217;t read the ~/.ssh/config
            file yet
            
            </li>
            <li>Highline 1.5 not working in Ruby 1.9 (password prompts hang)
            
            </li>
            <li><a href="../classes/Rye.html">Rye</a> uses OpenSSL&#8217;s ssh-agent (if it
            exists). <a href="../classes/Rye.html">Rye</a> starts it up as a child
            process and shuts it down using at_exit. If you have code in an at_exit
            that rely&#8217;s on <a href="../classes/Rye.html">Rye</a>, make sure your
            code runs before Rye&#8217;s at_exit block is called. For example, Drydock
            uses at_exit too which is why in <a href="bin/rye.html">bin/rye</a> you can
            see that Drydock is called explicitly so that Rye&#8217;s at_exit is
            executed after Drydock executes a command.
            
            </li>
            </ul>
            <h2>Thanks</h2>
            <ul>
            <li>Solutious Incorporated (<a href="http://solutious.com">solutious.com</a>)
            for all the orange juice.
            
            </li>
            <li>Kalin Harvey (<a href="http://rely.ca">rely.ca</a>)
            
            </li>
            <li><a href="http://github.com/adamwiggins/rush">Rush</a>
            
            </li>
            <li><a
            href="http://github.com/jamis/capistrano/blob/master/lib/capistrano/shell.rb">Capistrano</a>
            
            </li>
            </ul>
            <h2>More Info</h2>
            <ul>
            <li><a href="http://github.com/delano/rye">GitHub</a>
            
            </li>
            <li><a href="http://delano.github.com/rye">Rdocs</a>
            
            </li>
            <li><a href="http://www.youtube.com/watch?v=_StUVh6ENuw">Inspiration</a>
            
            </li>
            </ul>
            <h2>Credits</h2>
            <ul>
            <li>Delano Mandelbaum (delano@solutious.com)
            
            </li>
            <li>Escape, Copyright (C) 2006,2007 Tanaka Akira <akr@fsij.org>
            
            </li>
            </ul>
            <h2>License</h2>
            <p>
            See: <a href="LICENSE_txt.html">LICENSE.txt</a>
            </p>
          </div>
          <div id='section'>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
