<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=US-ASCII" http-equiv="Content-Type">

<title>class Rye::Hop - rye 0.9.8</title>

<link type="text/css" media="screen" href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../index.html">Home</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/rye/hop.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="../Object.html">Object</a>
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-new">::new</a>
    
    <li><a href="#method-i-3D-3D">#==</a>
    
    <li><a href="#method-i-add_key">#add_key</a>
    
    <li><a href="#method-i-add_keys">#add_keys</a>
    
    <li><a href="#method-i-connect">#connect</a>
    
    <li><a href="#method-i-debug-3F">#debug?</a>
    
    <li><a href="#method-i-disconnect">#disconnect</a>
    
    <li><a href="#method-i-error-3F">#error?</a>
    
    <li><a href="#method-i-exception_hook-3D">#exception_hook=</a>
    
    <li><a href="#method-i-fetch_port">#fetch_port</a>
    
    <li><a href="#method-i-host">#host</a>
    
    <li><a href="#method-i-host-3D">#host=</a>
    
    <li><a href="#method-i-host_key">#host_key</a>
    
    <li><a href="#method-i-info-3F">#info?</a>
    
    <li><a href="#method-i-inspect">#inspect</a>
    
    <li><a href="#method-i-keys">#keys</a>
    
    <li><a href="#method-i-nickname">#nickname</a>
    
    <li><a href="#method-i-nickname-3D">#nickname=</a>
    
    <li><a href="#method-i-opts">#opts</a>
    
    <li><a href="#method-i-opts-3D">#opts=</a>
    
    <li><a href="#method-i-remove_hops-21">#remove_hops!</a>
    
    <li><a href="#method-i-remove_key">#remove_key</a>
    
    <li><a href="#method-i-remove_keys">#remove_keys</a>
    
    <li><a href="#method-i-root-3F">#root?</a>
    
    <li><a href="#method-i-ssh_config_options">#ssh_config_options</a>
    
    <li><a href="#method-i-switch_user">#switch_user</a>
    
    <li><a href="#method-i-to_s">#to_s</a>
    
    <li><a href="#method-i-user">#user</a>
    
    <li><a href="#method-i-via">#via</a>
    
    <li><a href="#method-i-via-3F">#via?</a>
    
    <li><a href="#method-i-via_hop">#via_hop</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="../LICENSE_txt.html">LICENSE</a>
  
    <li class="file"><a href="../README_rdoc.html">README</a>
  
    <li class="file"><a href="../VERSION.html">VERSION</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../Rye.html">Rye</a>
  
    <li><a href="../Rye/Box.html">Rye::Box</a>
  
    <li><a href="../Rye/Box/InstanceExecHelper.html">Rye::Box::InstanceExecHelper</a>
  
    <li><a href="../Rye/Cmd.html">Rye::Cmd</a>
  
    <li><a href="../Rye/CommandNotFound.html">Rye::CommandNotFound</a>
  
    <li><a href="../Rye/Err.html">Rye::Err</a>
  
    <li><a href="../Rye/Hop.html">Rye::Hop</a>
  
    <li><a href="../Rye/Key.html">Rye::Key</a>
  
    <li><a href="../Rye/Key/BadFile.html">Rye::Key::BadFile</a>
  
    <li><a href="../Rye/Key/BadPerm.html">Rye::Key::BadPerm</a>
  
    <li><a href="../Rye/NoBoxes.html">Rye::NoBoxes</a>
  
    <li><a href="../Rye/NoHost.html">Rye::NoHost</a>
  
    <li><a href="../Rye/NoPassword.html">Rye::NoPassword</a>
  
    <li><a href="../Rye/NoPty.html">Rye::NoPty</a>
  
    <li><a href="../Rye/NotConnected.html">Rye::NotConnected</a>
  
    <li><a href="../Rye/Rap.html">Rye::Rap</a>
  
    <li><a href="../Rye/RyeError.html">Rye::RyeError</a>
  
    <li><a href="../Rye/Set.html">Rye::Set</a>
  
    <li><a href="../Rye/Tpl.html">Rye::Tpl</a>
  
    <li><a href="../Rye/VERSION.html">Rye::VERSION</a>
  
    <li><a href="../Object.html">Object</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class Rye::Hop</h1>

  <div id="description" class="description">
    
<h1 id="label-Rye%3A%3AHop"><a href="Hop.html">Rye::Hop</a></h1>

<p>The <a href="Hop.html">Rye::Hop</a> class represents a machine.  This class
allows boxes to by accessed via it.</p>

<pre class="ruby"><span class="ruby-identifier">rhop</span> = <span class="ruby-constant">Rye</span><span class="ruby-operator">::</span><span class="ruby-constant">Hop</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">'firewall.lan'</span>)
<span class="ruby-identifier">rbox</span> = <span class="ruby-constant">Rye</span><span class="ruby-operator">::</span><span class="ruby-constant">Box</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">'filibuster'</span>, :<span class="ruby-identifier">via</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rhop</span>)
<span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">uptime</span>     <span class="ruby-comment"># =&gt; 20:53  up 1 day,  1:52, 4 users</span>
</pre>

<p>Or</p>

<pre class="ruby"><span class="ruby-identifier">rbox</span> = <span class="ruby-constant">Rye</span><span class="ruby-operator">::</span><span class="ruby-constant">Box</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">'filibuster'</span>, :<span class="ruby-identifier">via</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'firewall.lan'</span>)
</pre>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="MAX_PORT">MAX_PORT
        
        <dd class="description"><p>The maximum port number that the gateway will attempt to use to forward
connections from.</p>
        
      
        <dt id="MIN_PORT">MIN_PORT
        
        <dd class="description"><p>The minimum port number that the gateway will attempt to use to forward
connections from.</p>
        
      
      </dl>
    </section>
    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(host, opts={})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><code>host</code> The hostname to connect to. Default: localhost.</p>
</li><li>
<p><code>user</code> The username to connect as. Default: SSH config file or
current shell user.</p>
</li><li>
<p><code>opts</code> a hash of optional arguments.</p>
</li></ul>

<p>The <code>opts</code> hash excepts the following keys:</p>
<ul><li>
<p>:port =&gt; remote server ssh port. Default: SSH config file or 22</p>
</li><li>
<p>:keys =&gt; one or more private key file paths (passwordless login)</p>
</li><li>
<p>:via =&gt; the <a href="Hop.html">Rye::Hop</a> to access this host through</p>
</li><li>
<p>:info =&gt; an IO object to print <a href="Box.html">Rye::Box</a> command
info to. Default: nil</p>
</li><li>
<p>:debug =&gt; an IO object to print <a href="Box.html">Rye::Box</a>
debugging info to. Default: nil</p>
</li><li>
<p>:error =&gt; an IO object to print <a href="Box.html">Rye::Box</a> errors
to. Default: STDERR</p>
</li><li>
<p>:getenv =&gt; pre-fetch <code>host</code> environment variables? (default:
true)</p>
</li><li>
<p>:password =&gt; the user's password (ignored if there's a valid private
key)</p>
</li><li>
<p>:templates =&gt; the template engine to use for uploaded files. One of:
:erb (default)</p>
</li><li>
<p>:sudo =&gt; Run all commands via sudo (default: false)</p>
</li></ul>

<p>NOTE: <code>opts</code> can also contain any parameter supported by 
Net::SSH.start that is not already mentioned above.</p>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 81</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">opts</span>={})
  <span class="ruby-identifier">ssh_opts</span> = <span class="ruby-identifier">ssh_config_options</span>(<span class="ruby-identifier">host</span>)
  <span class="ruby-ivar">@rye_exception_hook</span> = {}
  <span class="ruby-ivar">@rye_host</span> = <span class="ruby-identifier">host</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:user</span>]
    <span class="ruby-ivar">@rye_user</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:user</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@rye_user</span> = <span class="ruby-identifier">ssh_opts</span>[<span class="ruby-value">:user</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Rye</span>.<span class="ruby-identifier">sysinfo</span>.<span class="ruby-identifier">user</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment"># These opts are use by Rye::Box and also passed to</span>
  <span class="ruby-comment"># Net::SSH::Gateway (and Net::SSH)</span>
  <span class="ruby-ivar">@rye_opts</span> = {
    <span class="ruby-value">:port</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ssh_opts</span>[<span class="ruby-value">:port</span>],
    <span class="ruby-value">:keys</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Rye</span>.<span class="ruby-identifier">keys</span>,
    <span class="ruby-value">:via</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
    <span class="ruby-value">:info</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
    <span class="ruby-value">:debug</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
    <span class="ruby-value">:error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">STDERR</span>,
    <span class="ruby-value">:getenv</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>,
    <span class="ruby-value">:templates</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:erb</span>,
    <span class="ruby-value">:quiet</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>
  }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>)

  <span class="ruby-ivar">@next_port</span> = <span class="ruby-constant">MAX_PORT</span>

  <span class="ruby-comment"># Close the SSH session before Ruby exits. This will do nothing</span>
  <span class="ruby-comment"># if disconnect has already been called explicitly. </span>
  <span class="ruby-identifier">at_exit</span> { <span class="ruby-keyword">self</span>.<span class="ruby-identifier">disconnect</span> }

  <span class="ruby-comment"># Properly handle whether the opt :via is a +Rye::Hop+ or a +String+</span>
  <span class="ruby-comment"># and does nothing if nil</span>
  <span class="ruby-identifier">via_hop</span>(<span class="ruby-ivar">@rye_opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:via</span>))

  <span class="ruby-comment"># @rye_opts gets sent to Net::SSH so we need to remove the keys</span>
  <span class="ruby-comment"># that are not meant for it. </span>
  <span class="ruby-ivar">@rye_safe</span>, <span class="ruby-ivar">@rye_debug</span> = <span class="ruby-ivar">@rye_opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:safe</span>), <span class="ruby-ivar">@rye_opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:debug</span>)
  <span class="ruby-ivar">@rye_info</span>, <span class="ruby-ivar">@rye_error</span> = <span class="ruby-ivar">@rye_opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:info</span>), <span class="ruby-ivar">@rye_opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:error</span>)
  <span class="ruby-ivar">@rye_getenv</span> = {} <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rye_opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:getenv</span>) <span class="ruby-comment"># Enable getenv with a hash</span>
  <span class="ruby-ivar">@rye_ostype</span>, <span class="ruby-ivar">@rye_impltype</span> = <span class="ruby-ivar">@rye_opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:ostype</span>), <span class="ruby-ivar">@rye_opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:impltype</span>)
  <span class="ruby-ivar">@rye_quiet</span>, <span class="ruby-ivar">@rye_sudo</span> = <span class="ruby-ivar">@rye_opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:quiet</span>), <span class="ruby-ivar">@rye_opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:sudo</span>)
  <span class="ruby-ivar">@rye_templates</span> = <span class="ruby-ivar">@rye_opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:templates</span>)
  
  <span class="ruby-comment"># Store the state of the terminal </span>
  <span class="ruby-ivar">@rye_stty_save</span> = <span class="ruby-value">%xstty -g`</span>.<span class="ruby-identifier">chomp</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
  
  <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@rye_templates</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">require</span> <span class="ruby-ivar">@rye_templates</span>.<span class="ruby-identifier">to_s</span>   <span class="ruby-comment"># should be :erb</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-ivar">@rye_opts</span>[<span class="ruby-value">:logger</span>] = <span class="ruby-constant">Logger</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@rye_debug</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rye_debug</span> <span class="ruby-comment"># Enable Net::SSH debugging</span>
  <span class="ruby-ivar">@rye_opts</span>[<span class="ruby-value">:keys</span>] = [<span class="ruby-ivar">@rye_opts</span>[<span class="ruby-value">:keys</span>]].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>
  
  <span class="ruby-comment"># Just in case someone sends a true value rather than IO object</span>
  <span class="ruby-ivar">@rye_debug</span> = <span class="ruby-constant">STDERR</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rye_debug</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">||</span> <span class="ruby-constant">DEBUG</span>
  <span class="ruby-ivar">@rye_error</span> = <span class="ruby-constant">STDERR</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rye_error</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
  <span class="ruby-ivar">@rye_info</span> = <span class="ruby-constant">STDOUT</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rye_info</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
  
  <span class="ruby-comment"># Add the given private keys to the keychain that will be used for @rye_host</span>
  <span class="ruby-identifier">add_keys</span>(<span class="ruby-ivar">@rye_opts</span>[<span class="ruby-value">:keys</span>])
  
  <span class="ruby-comment"># From: capistrano/lib/capistrano/cli.rb</span>
  <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">sync</span> = <span class="ruby-keyword">true</span> <span class="ruby-comment"># so that Net::SSH prompts show up</span>
  
  <span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;ssh-agent info: #{Rye.sshagent_info.inspect}&quot;</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-ivar">@rye_opts</span>.<span class="ruby-identifier">inspect</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-3D-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">==</span><span
            class="method-args">(other)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Compares itself with the <code>other</code> box. If the hostnames are the
same, this will return true. Otherwise false.</p>
          

          
          <div class="method-source-code" id="3D-3D-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 361</span>
<span class="ruby-keyword">def</span> <span class="ruby-operator">==</span>(<span class="ruby-identifier">other</span>)
  <span class="ruby-ivar">@rye_host</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">host</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- 3D-3D-source -->
          
        </div>

        

        
      </div><!-- 3D-3D-method -->

    
      <div id="method-i-add_key" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">add_key</span><span
            class="method-args">(*keys)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="Hop.html#method-i-add_keys">add_keys</a>
        </div>
        
      </div><!-- add_key-method -->

    
      <div id="method-i-add_keys" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_keys</span><span
            class="method-args">(*keys)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Add one or more private keys to the list of key paths.</p>
<ul><li>
<p><code>keys</code> is a list of file paths to private keys</p>
</li></ul>

<p>Returns the instance of <a href="Box.html">Box</a></p>
          

          
          <div class="method-source-code" id="add_keys-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 204</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_keys</span>(*<span class="ruby-identifier">keys</span>)
  <span class="ruby-ivar">@rye_opts</span>[<span class="ruby-value">:keys</span>] <span class="ruby-operator">||=</span> []
  <span class="ruby-ivar">@rye_opts</span>[<span class="ruby-value">:keys</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>
  <span class="ruby-ivar">@rye_opts</span>[<span class="ruby-value">:keys</span>].<span class="ruby-identifier">uniq!</span>
  <span class="ruby-keyword">self</span> <span class="ruby-comment"># MUST RETURN self</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- add_keys-source -->
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="Hop.html#method-i-add_key">add_key</a>
        </div>
        

        
      </div><!-- add_keys-method -->

    
      <div id="method-i-connect" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">connect</span><span
            class="method-args">(reconnect=true)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Open an SSH session with +@rye_host+. This called automatically when you
the first comamnd is run if it's not already connected. Raises a <a
href="NoHost.html">Rye::NoHost</a> exception if +@rye_host+ is not
specified. Will attempt a password login up to 3 times if the initial 
authentication fails.</p>
<ul><li>
<p><code>reconnect</code> Disconnect first if already connected. The default</p>
</li></ul>

<p>is true. When set to false, connect will do nothing if already  connected.</p>
          

          
          <div class="method-source-code" id="connect-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 246</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">connect</span>(<span class="ruby-identifier">reconnect</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">Rye</span><span class="ruby-operator">::</span><span class="ruby-constant">NoHost</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@rye_host</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rye_ssh</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">reconnect</span>
  <span class="ruby-identifier">disconnect</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rye_ssh</span> 
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rye_via</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Opening connection to #{@rye_host} as #{@rye_user}, via #{@rye_via.host}&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Opening connection to #{@rye_host} as #{@rye_user}&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">highline</span> = <span class="ruby-constant">HighLine</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment"># Used for password prompt</span>
  <span class="ruby-identifier">retried</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@rye_opts</span>[<span class="ruby-value">:keys</span>].<span class="ruby-identifier">compact!</span>  <span class="ruby-comment"># A quick fix in Windows. TODO: Why is there a nil?</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rye_via</span>
      <span class="ruby-comment"># tell the +Rye::Hop+ what and where to setup,</span>
      <span class="ruby-comment"># it returns the local port used</span>
      <span class="ruby-ivar">@rye_localport</span> = <span class="ruby-ivar">@rye_via</span>.<span class="ruby-identifier">fetch_port</span>(<span class="ruby-ivar">@rye_host</span>, <span class="ruby-ivar">@rye_opts</span>[<span class="ruby-value">:port</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">22</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@rye_opts</span>[<span class="ruby-value">:port</span>] )
      <span class="ruby-ivar">@rye_ssh</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span>.<span class="ruby-identifier">start</span>(<span class="ruby-string">&quot;localhost&quot;</span>, <span class="ruby-ivar">@rye_user</span>, <span class="ruby-ivar">@rye_opts</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:port</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@rye_localport</span>) <span class="ruby-operator">||</span> {}) 
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@rye_ssh</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span>.<span class="ruby-identifier">start</span>(<span class="ruby-ivar">@rye_host</span>, <span class="ruby-ivar">@rye_user</span>, <span class="ruby-ivar">@rye_opts</span> <span class="ruby-operator">||</span> {}) 
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;starting the port forward thread&quot;</span>
    <span class="ruby-identifier">port_loop</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">HostKeyMismatch</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ex</span>
    <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">message</span>
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;\a&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rye_info</span> <span class="ruby-comment"># Ring the bell</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">highline</span>.<span class="ruby-identifier">ask</span>(<span class="ruby-string">&quot;Continue? &quot;</span>).<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">%r\Ay|yes|sure|ya\z/</span>)
      <span class="ruby-ivar">@rye_opts</span>[<span class="ruby-value">:paranoid</span>] = <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">retry</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">HostKeyMismatch</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">AuthenticationFailed</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ex</span>
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;\a&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">retried</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@rye_info</span> <span class="ruby-comment"># Ring the bell once</span>
    <span class="ruby-identifier">retried</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">STDIN</span>.<span class="ruby-identifier">tty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">retried</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">3</span>
      <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Passwordless login failed for #{@rye_user}&quot;</span>
      <span class="ruby-ivar">@rye_opts</span>[<span class="ruby-value">:password</span>] = <span class="ruby-identifier">highline</span>.<span class="ruby-identifier">ask</span>(<span class="ruby-string">&quot;Password: &quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">q</span><span class="ruby-operator">|</span> <span class="ruby-identifier">q</span>.<span class="ruby-identifier">echo</span> = <span class="ruby-string">''</span> }.<span class="ruby-identifier">strip</span>
      <span class="ruby-ivar">@rye_opts</span>[<span class="ruby-value">:auth_methods</span>] <span class="ruby-operator">||=</span> []
      <span class="ruby-ivar">@rye_opts</span>[<span class="ruby-value">:auth_methods</span>].<span class="ruby-identifier">push</span> *[<span class="ruby-string">'keyboard-interactive'</span>, <span class="ruby-string">'password'</span>]
      <span class="ruby-keyword">retry</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">AuthenticationFailed</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment"># We add :auth_methods (a Net::SSH joint) to force asking for a</span>
  <span class="ruby-comment"># password if the initial (key-based) authentication fails. We</span>
  <span class="ruby-comment"># need to delete the key from @rye_opts otherwise it lingers until</span>
  <span class="ruby-comment"># the next connection (if we switch_user is called for example).</span>
  <span class="ruby-ivar">@rye_opts</span>.<span class="ruby-identifier">delete</span> <span class="ruby-value">:auth_methods</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rye_opts</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:auth_methods</span>)
  
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- connect-source -->
          
        </div>

        

        
      </div><!-- connect-method -->

    
      <div id="method-i-debug-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">debug?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="debug-3F-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 54</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">debug?</span>; <span class="ruby-operator">!</span><span class="ruby-ivar">@rye_debug</span>.<span class="ruby-identifier">nil?</span>; <span class="ruby-keyword">end</span></pre>
          </div><!-- debug-3F-source -->
          
        </div>

        

        
      </div><!-- debug-3F-method -->

    
      <div id="method-i-disconnect" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">disconnect</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Close the SSH session  with +@rye_host+. This is called  automatically at
exit if the connection is open.</p>
          

          
          <div class="method-source-code" id="disconnect-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 317</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">disconnect</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@rye_ssh</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@rye_ssh</span>.<span class="ruby-identifier">closed?</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;removing active forwards&quot;</span>
    <span class="ruby-identifier">remove_hops!</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;killing port_loop @rye_port_thread&quot;</span>
    <span class="ruby-ivar">@rye_port_thread</span>.<span class="ruby-identifier">kill</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rye_ssh</span>.<span class="ruby-identifier">busy?</span>;
      <span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Is something still running? (ctrl-C to exit)&quot;</span>
      <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-identifier">timeout</span>(<span class="ruby-value">10</span>) <span class="ruby-keyword">do</span>
        <span class="ruby-ivar">@rye_ssh</span>.<span class="ruby-identifier">loop</span>(<span class="ruby-value">0.3</span>) { <span class="ruby-ivar">@rye_ssh</span>.<span class="ruby-identifier">busy?</span>; }
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Closing connection to #{@rye_ssh.host}&quot;</span>
    <span class="ruby-ivar">@rye_ssh</span>.<span class="ruby-identifier">close</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rye_via</span>
      <span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;disconnecting Hop #{@rye_via.host}&quot;</span>
      <span class="ruby-ivar">@rye_via</span>.<span class="ruby-identifier">disconnect</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">SystemCallError</span>, <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ex</span>
    <span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Rye::Hop: Disconnect timeout (#{ex.message})&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">backtrace</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Interrupt</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;Exiting...&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- disconnect-source -->
          
        </div>

        

        
      </div><!-- disconnect-method -->

    
      <div id="method-i-error-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">error?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="error-3F-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 55</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">error?</span>; <span class="ruby-operator">!</span><span class="ruby-ivar">@rye_error</span>.<span class="ruby-identifier">nil?</span>; <span class="ruby-keyword">end</span></pre>
          </div><!-- error-3F-source -->
          
        </div>

        

        
      </div><!-- error-3F-method -->

    
      <div id="method-i-exception_hook-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">exception_hook=</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>A Hash. The keys are exception classes, the values are Procs to execute</p>
          

          
          <div class="method-source-code" id="exception_hook-3D-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 59</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">exception_hook=</span>(<span class="ruby-identifier">val</span>); <span class="ruby-ivar">@rye_exception_hook</span> = <span class="ruby-identifier">val</span>; <span class="ruby-keyword">end</span></pre>
          </div><!-- exception_hook-3D-source -->
          
        </div>

        

        
      </div><!-- exception_hook-3D-method -->

    
      <div id="method-i-fetch_port" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">fetch_port</span><span
            class="method-args">(host, port = 22, localport = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>instance method, that will setup a forward, and return the port used</p>
          

          
          <div class="method-source-code" id="fetch_port-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 181</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">fetch_port</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span> = <span class="ruby-value">22</span>, <span class="ruby-identifier">localport</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">connect</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@rye_ssh</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">localport</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">port_used</span> = <span class="ruby-identifier">next_port</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">port_used</span> = <span class="ruby-identifier">localport</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># i would like to check if the port and host </span>
  <span class="ruby-comment"># are already an active_locals forward, but that </span>
  <span class="ruby-comment"># info does not get returned, and trusting the localport</span>
  <span class="ruby-comment"># is not enough information, so lets just set up a new one</span>
  <span class="ruby-ivar">@rye_ssh</span>.<span class="ruby-identifier">forward</span>.<span class="ruby-identifier">local</span>(<span class="ruby-identifier">port_used</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">port_used</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- fetch_port-source -->
          
        </div>

        

        
      </div><!-- fetch_port-method -->

    
      <div id="method-i-host" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">host</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="host-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 39</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">host</span>; <span class="ruby-ivar">@rye_host</span>; <span class="ruby-keyword">end</span></pre>
          </div><!-- host-source -->
          
        </div>

        

        
      </div><!-- host-method -->

    
      <div id="method-i-host-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">host=</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="host-3D-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 48</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">host=</span>(<span class="ruby-identifier">val</span>); <span class="ruby-ivar">@rye_host</span> = <span class="ruby-identifier">val</span>; <span class="ruby-keyword">end</span></pre>
          </div><!-- host-3D-source -->
          
        </div>

        

        
      </div><!-- host-3D-method -->

    
      <div id="method-i-host_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">host_key</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Returns the host SSH keys for this box</p>
          

          
          <div class="method-source-code" id="host_key-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 366</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">host_key</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;No host&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@rye_host</span>
  <span class="ruby-constant">Rye</span>.<span class="ruby-identifier">remote_host_keys</span>(<span class="ruby-ivar">@rye_host</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- host_key-source -->
          
        </div>

        

        
      </div><!-- host_key-method -->

    
      <div id="method-i-info-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">info?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="info-3F-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 53</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">info?</span>; <span class="ruby-operator">!</span><span class="ruby-ivar">@rye_info</span>.<span class="ruby-identifier">nil?</span>; <span class="ruby-keyword">end</span></pre>
          </div><!-- info-3F-source -->
          
        </div>

        

        
      </div><!-- info-3F-method -->

    
      <div id="method-i-inspect" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">inspect</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="inspect-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 350</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">inspect</span>
  <span class="ruby-string">%q{#&lt;%s:%s name=%s cwd=%s umask=%s env=%s via=%s opts=%s keys=%s&gt;}</span> <span class="ruby-operator">%</span> 
  [<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">host</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">nickname</span>,
   <span class="ruby-ivar">@rye_current_working_directory</span>, <span class="ruby-ivar">@rye_current_umask</span>,
   (<span class="ruby-ivar">@rye_current_environment_variables</span> <span class="ruby-operator">||</span> <span class="ruby-string">''</span>).<span class="ruby-identifier">inspect</span>,
   (<span class="ruby-ivar">@rye_via</span> <span class="ruby-operator">||</span> <span class="ruby-string">''</span>).<span class="ruby-identifier">inspect</span>,
   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">opts</span>.<span class="ruby-identifier">inspect</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">inspect</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- inspect-source -->
          
        </div>

        

        
      </div><!-- inspect-method -->

    
      <div id="method-i-keys" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">keys</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>See <a href="../Rye.html#method-i-keys">Rye#keys</a></p>
          

          
          <div class="method-source-code" id="keys-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 345</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">keys</span>; <span class="ruby-constant">Rye</span>.<span class="ruby-identifier">keys</span>; <span class="ruby-keyword">end</span></pre>
          </div><!-- keys-source -->
          
        </div>

        

        
      </div><!-- keys-method -->

    
      <div id="method-i-nickname" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">nickname</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="nickname-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 44</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">nickname</span>; <span class="ruby-ivar">@rye_nickname</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">host</span>; <span class="ruby-keyword">end</span></pre>
          </div><!-- nickname-source -->
          
        </div>

        

        
      </div><!-- nickname-method -->

    
      <div id="method-i-nickname-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">nickname=</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="nickname-3D-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 47</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">nickname=</span>(<span class="ruby-identifier">val</span>); <span class="ruby-ivar">@rye_nickname</span> = <span class="ruby-identifier">val</span>; <span class="ruby-keyword">end</span></pre>
          </div><!-- nickname-3D-source -->
          
        </div>

        

        
      </div><!-- nickname-3D-method -->

    
      <div id="method-i-opts" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">opts</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="opts-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 40</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">opts</span>; <span class="ruby-ivar">@rye_opts</span>; <span class="ruby-keyword">end</span></pre>
          </div><!-- opts-source -->
          
        </div>

        

        
      </div><!-- opts-method -->

    
      <div id="method-i-opts-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">opts=</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="opts-3D-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 49</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">opts=</span>(<span class="ruby-identifier">val</span>); <span class="ruby-ivar">@rye_opts</span> = <span class="ruby-identifier">val</span>; <span class="ruby-keyword">end</span></pre>
          </div><!-- opts-3D-source -->
          
        </div>

        

        
      </div><!-- opts-3D-method -->

    
      <div id="method-i-remove_hops-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">remove_hops!</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Cancel the port forward on all active local forwards</p>
          

          
          <div class="method-source-code" id="remove_hops-21-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 302</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">remove_hops!</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@rye_ssh</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@rye_ssh</span>.<span class="ruby-identifier">forward</span>.<span class="ruby-identifier">active_locals</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  <span class="ruby-ivar">@rye_ssh</span>.<span class="ruby-identifier">forward</span>.<span class="ruby-identifier">active_locals</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">fport</span>, <span class="ruby-identifier">fhost</span><span class="ruby-operator">|</span> 
    <span class="ruby-ivar">@rye_ssh</span>.<span class="ruby-identifier">forward</span>.<span class="ruby-identifier">cancel_local</span>(<span class="ruby-identifier">fport</span>, <span class="ruby-identifier">fhost</span>)
  }
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@rye_ssh</span>.<span class="ruby-identifier">channels</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-ivar">@rye_ssh</span>.<span class="ruby-identifier">channels</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">channel</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">channel</span>[<span class="ruby-value">-1</span>].<span class="ruby-identifier">close</span>
    }
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@rye_ssh</span>.<span class="ruby-identifier">forward</span>.<span class="ruby-identifier">active_locals</span>.<span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- remove_hops-21-source -->
          
        </div>

        

        
      </div><!-- remove_hops-21-method -->

    
      <div id="method-i-remove_key" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">remove_key</span><span
            class="method-args">(*keys)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="Hop.html#method-i-remove_keys">remove_keys</a>
        </div>
        
      </div><!-- remove_key-method -->

    
      <div id="method-i-remove_keys" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">remove_keys</span><span
            class="method-args">(*keys)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Remove one or more private keys fromt he list of key paths.</p>
<ul><li>
<p><code>keys</code> is a list of file paths to private keys</p>
</li></ul>

<p>Returns the instance of <a href="Box.html">Box</a></p>
          

          
          <div class="method-source-code" id="remove_keys-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 215</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">remove_keys</span>(*<span class="ruby-identifier">keys</span>)
  <span class="ruby-ivar">@rye_opts</span>[<span class="ruby-value">:keys</span>] <span class="ruby-operator">||=</span> []
  <span class="ruby-ivar">@rye_opts</span>[<span class="ruby-value">:keys</span>] <span class="ruby-operator">-=</span> <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>
  <span class="ruby-ivar">@rye_opts</span>[<span class="ruby-value">:keys</span>].<span class="ruby-identifier">uniq!</span>
  <span class="ruby-keyword">self</span> <span class="ruby-comment"># MUST RETURN self</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- remove_keys-source -->
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="Hop.html#method-i-remove_key">remove_key</a>
        </div>
        

        
      </div><!-- remove_keys-method -->

    
      <div id="method-i-root-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">root?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="root-3F-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 42</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">root?</span>; <span class="ruby-identifier">user</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;root&quot;</span> <span class="ruby-keyword">end</span></pre>
          </div><!-- root-3F-source -->
          
        </div>

        

        
      </div><!-- root-3F-method -->

    
      <div id="method-i-ssh_config_options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ssh_config_options</span><span
            class="method-args">(host)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Parse SSH config files for use with Net::SSH</p>
          

          
          <div class="method-source-code" id="ssh_config_options-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 197</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ssh_config_options</span>(<span class="ruby-identifier">host</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Config</span>.<span class="ruby-identifier">for</span>(<span class="ruby-identifier">host</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- ssh_config_options-source -->
          
        </div>

        

        
      </div><!-- ssh_config_options-method -->

    
      <div id="method-i-switch_user" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">switch_user</span><span
            class="method-args">(newuser)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Reconnect as another user. This is different from su= which executes
subsequent commands via +su -c COMMAND USER+.</p>
<ul><li>
<p><code>newuser</code> The username to reconnect as</p>
</li></ul>

<p>NOTE: if there is an open connection, it's disconnected but not reconnected
because it's possible it wasn't  connected yet in the first place (if you
create the  instance with default settings for example)</p>
          

          
          <div class="method-source-code" id="switch_user-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 231</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">switch_user</span>(<span class="ruby-identifier">newuser</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">newuser</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-ivar">@rye_opts</span> <span class="ruby-operator">||=</span> {}
  <span class="ruby-ivar">@rye_user</span> = <span class="ruby-identifier">newuser</span>
  <span class="ruby-identifier">disconnect</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- switch_user-source -->
          
        </div>

        

        
      </div><!-- switch_user-method -->

    
      <div id="method-i-to_s" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_s</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Returns +user@rye_host+</p>
          

          
          <div class="method-source-code" id="to_s-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 348</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">to_s</span>; <span class="ruby-string">'%s@rye_%s'</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">user</span>, <span class="ruby-ivar">@rye_host</span>]; <span class="ruby-keyword">end</span></pre>
          </div><!-- to_s-source -->
          
        </div>

        

        
      </div><!-- to_s-method -->

    
      <div id="method-i-user" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">user</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="user-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 41</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">user</span>; <span class="ruby-ivar">@rye_user</span>; <span class="ruby-keyword">end</span></pre>
          </div><!-- user-source -->
          
        </div>

        

        
      </div><!-- user-method -->

    
      <div id="method-i-via" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">via</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="via-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 45</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">via</span>; <span class="ruby-ivar">@rye_via</span>; <span class="ruby-keyword">end</span></pre>
          </div><!-- via-source -->
          
        </div>

        

        
      </div><!-- via-method -->

    
      <div id="method-i-via-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">via?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="via-3F-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 52</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">via?</span>; <span class="ruby-operator">!</span><span class="ruby-ivar">@rye_via</span>.<span class="ruby-identifier">nil?</span>; <span class="ruby-keyword">end</span></pre>
          </div><!-- via-3F-source -->
          
        </div>

        

        
      </div><!-- via-3F-method -->

    
      <div id="method-i-via_hop" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">via_hop</span><span
            class="method-args">(*hops)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><code>hops</code> <a href="Hop.html">Rye::Hop</a> objects will be added
directly</p>
</li></ul>

<p>to the set. Hostnames will be used to create new instances of <a
href="Hop.html">Rye::Hop</a>  h1 = <a
href="Hop.html#method-c-new">::new</a> "host1" h1.via_hop "host2", :user
=&gt; "service_user"</p>

<p>OR</p>

<p>h1 = <a href="Hop.html#method-c-new">::new</a> "host1" h2 = <a
href="Hop.html#method-c-new">::new</a> "host2" h1.via_hop h2</p>
          

          
          <div class="method-source-code" id="via_hop-source">
            <pre><span class="ruby-comment"># File lib/rye/hop.rb, line 161</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">via_hop</span>(*<span class="ruby-identifier">hops</span>)
  <span class="ruby-identifier">hops</span> = <span class="ruby-identifier">hops</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span> 
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">hops</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-ivar">@rye_via</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">hops</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Rye</span><span class="ruby-operator">::</span><span class="ruby-constant">Hop</span>)
    <span class="ruby-ivar">@rye_via</span> = <span class="ruby-identifier">hops</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">hops</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
    <span class="ruby-identifier">hop</span> = <span class="ruby-identifier">hops</span>.<span class="ruby-identifier">shift</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">hops</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
      <span class="ruby-ivar">@rye_via</span> = <span class="ruby-constant">Rye</span><span class="ruby-operator">::</span><span class="ruby-constant">Hop</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">hop</span>, <span class="ruby-identifier">hops</span>.<span class="ruby-identifier">first</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@rye_via</span> = <span class="ruby-constant">Rye</span><span class="ruby-operator">::</span><span class="ruby-constant">Hop</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">hop</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">disconnect</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- via_hop-source -->
          
        </div>

        

        
      </div><!-- via_hop-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

