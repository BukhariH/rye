<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

  <title>File: README.rdoc [Rye: Safely run SSH commands on a bunch of machines at the same time (from Ruby).]</title>

  <link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet" />

  <script src="./js/jquery.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/thickbox-compressed.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/quicksearch.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/darkfish.js" type="text/javascript"
    charset="utf-8"></script>
</head>

<body class="file">
  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="./index.html">Home</a>
          <a href="./index.html#classes">Classes</a>
          <a href="./index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="./CHANGES_txt.html">CHANGES.txt</a></li>
        
          <li class="file"><a href="./LICENSE_txt.html">LICENSE.txt</a></li>
        
          <li class="file"><a href="./README_rdoc.html">README.rdoc</a></li>
        
          <li class="file"><a href="./bin/try.html">try</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class Index
          <span class="search-toggle"><img src="./images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="./Rye.html">Rye</a></li>
        
          <li><a href="./Rye/Box.html">Rye::Box</a></li>
        
          <li><a href="./Rye/Box/InstanceExecHelper.html">Rye::Box::InstanceExecHelper</a></li>
        
          <li><a href="./Rye/Cmd.html">Rye::Cmd</a></li>
        
          <li><a href="./Rye/CommandNotFound.html">Rye::CommandNotFound</a></li>
        
          <li><a href="./Rye/Err.html">Rye::Err</a></li>
        
          <li><a href="./Rye/Hop.html">Rye::Hop</a></li>
        
          <li><a href="./Rye/Key.html">Rye::Key</a></li>
        
          <li><a href="./Rye/Key/BadFile.html">Rye::Key::BadFile</a></li>
        
          <li><a href="./Rye/Key/BadPerm.html">Rye::Key::BadPerm</a></li>
        
          <li><a href="./Rye/NoBoxes.html">Rye::NoBoxes</a></li>
        
          <li><a href="./Rye/NoHost.html">Rye::NoHost</a></li>
        
          <li><a href="./Rye/NoPassword.html">Rye::NoPassword</a></li>
        
          <li><a href="./Rye/NoPty.html">Rye::NoPty</a></li>
        
          <li><a href="./Rye/NotConnected.html">Rye::NotConnected</a></li>
        
          <li><a href="./Rye/Rap.html">Rye::Rap</a></li>
        
          <li><a href="./Rye/RyeError.html">Rye::RyeError</a></li>
        
          <li><a href="./Rye/Set.html">Rye::Set</a></li>
        
          <li><a href="./Rye/Tpl.html">Rye::Tpl</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    
<h1><a href="Rye.html">Rye</a> - v0.9</h1>

<p><b>Safely run SSH commands on a bunch of machines at the same time (from
Ruby)</b>.</p>

<p>Inspired by <a href="http://rush.heroku.com">Rush</a> and compatible with
Ruby 1.8, 1.9, and JRuby 1.3+!</p>

<h2>Overview</h2>

<p><a href="Rye.html">Rye</a> is a Ruby abstraction for executing shell
commands via SSH. By default, <a href="Rye.html">Rye</a> errs on the side
of caution by running in "safe-mode" which specifies a default whitelist of
commands and aggressively escapes all command arguments. For example, file
globs and the "rm" command are not available in safe-mode, so you can't do
this: <tt>rbox.rm('-rf', '/etc/*<b>/</b>')</tt>.</p>

<p><a href="Rye.html">Rye</a> does not require anything to be installed on the
server side (other than an SSH daemon) so it can be run from any machine
with Ruby, OpenSSL, and OpenSSH.</p>

<h2>Example 1 -- Execute commands on a remote machine</h2>

<p>Shell commands are executed by calling methods on a <a
href="Rye/Box.html">Rye::Box</a> object.</p>

<pre>rbox = Rye::Box.new('hostname')
rbox.pwd                               # =&gt; &quot;/home/rye&quot;
rbox.uname :a                          # =&gt; &quot;Darwin rye-stage 9.7.0 ...&quot;</pre>

<p>Method arguments are sent directly as arguments to the shell command.
Single-character Symbols are assumed to be single-character switches.
<em>e.g. <tt>rbox.uname :a</tt> becomes <tt>uname -a</tt>.</em></p>

<p>The return value for a command is a modified Array containing the contents
of STDOUT split by line. It also gives access to STDERR and the exit code</p>

<pre>ret = rbox.uptime                      # =&gt; &quot;11:02  up 16:01, 3 users&quot;
ret.stderr                             # =&gt; []
ret.exit_status                          # =&gt; 0
ret.stdout                             # =&gt; &quot;11:02  up 16:01, 3 users&quot;
ret.stdout.class                       # =&gt; Array
ret.class                              # =&gt; Rye::Rap</pre>

<h2>Example 2 -- Paths and environment variables</h2>

<p>You can change directories.</p>

<pre>rbox.cd '/tmp'
rbox.pwd                               # =&gt; '/tmp'
rbox['/etc'].ls                        # =&gt; ['apache', 'init.d', ...]
rbox.pwd                               # =&gt; '/etc'
rbox.cd                                # =&gt; '/home/rye'</pre>

<p>You can specify environment variables.</p>

<pre>rbox.setenv('TIPPLE', &quot;Forty Creek&quot;)
rbox.getenv 'TIPPLE'                   # =&gt; &quot;Forty Creek&quot;</pre>

<h2>Example 3 -- Adding and removing commands</h2>

<p>You can add and remove commands to the whitelist.</p>

<pre>Rye::Cmd.add_command :anything, '/usr/bin/uptime'
rbox = Rye::Box.new
rbox.anything                       
Rye::Cmd.remove_command :anything
rbox.anything                          # =&gt; Rye::CommandNotFound exception</pre>

<h2>Example 4 -- Disabling Safe Mode</h2>

<p>Safe mode can be disabled on one of the following ways.</p>

<pre>rbox = Rye::Box.new 'HOST', :safe =&gt; false
  OR
rbox.disable_safe_mode</pre>

<p>When safe-mode is disabled, you can run any command (regardless of what is
defined in the whitelist) with any valid arguments (fileglobs, tildas,
etc...).</p>

<pre>rbox.kill '-SIGHUP', 1928111
rbox.rm 'path/2/*'</pre>

<p>You can also execute any valid shell command.</p>

<pre>rbox.execute 'ps aux | grep ruby &gt; /tmp/ruby-process-list'</pre>

<p>See the "About Safe Mode" section below for more information.</p>

<h2>Example 5a -- Accessing Multiple Machines</h2>

<p>Shell commands can be executed on multiple machines using a <a
href="Rye/Set.html">Rye::Set</a> object. Create a "set" of machines.</p>

<pre>rbox = Rye::Box.new 'HOST1'
rset = Rye::Set.new
rset.add_boxes rbox, 'HOST2'           # Add boxes as hostnames or objects</pre>

<p>Then call methods just like with <a href="Rye/Box.html">Rye::Box</a>,
except now the return value is an Array of Arrays. The order of return
values matches the order the machines were added to the set.</p>

<pre>rset.hostname                          # =&gt; [[&quot;HOST1&quot;], [&quot;HOST2&quot;]]
rset.uname                             # =&gt; [[&quot;Darwin&quot;], [&quot;Linux&quot;]]</pre>

<h2>Example 5b -- Accessing Multiple Machines in Parallel</h2>

<p>By default, <a href="Rye/Set.html">Rye::Set</a> connects to each machine
sequentially in the order they were added to the set. Commands can also be
run in parallel.</p>

<pre>rset = Rye::Set.new &quot;SETNAME&quot;, :parallel =&gt; true
  OR
rset.parallel = true</pre>

<h2>Example 6 -- File Transfers</h2>

<pre>rbox = Rye::Box.new &quot;localhost&quot;

rbox.file_upload &quot;README.rdoc&quot;, &quot;/tmp&quot; 

applejack = StringIO.new &quot;Some in-memory content&quot;
rbox.file_upload applejack, &quot;/tmp/applejack.txt&quot;

rbox.ls &quot;/tmp/&quot;                 # =&gt; [README.rdoc, applejack.txt]
rbox.cat &quot;/tmp/applejack.txt&quot;   # =&gt; &quot;Some in-memory content&quot;

filecontent = StringIO.new
rbox.file_download &quot;/tmp/applejack.txt&quot;, filecontent

filecontent.read                # =&gt; &quot;Some in-memory content&quot;</pre>

<h2>Example 7 -- Local processes</h2>

<p>For local processes, you can bypass <tt>Rye::Box</tt> and execute commands
directly with <tt>Rye.shell</tt>:</p>

<pre>Rye.shell :uptime    # =&gt; 11:02  up 16:01, 3 users</pre>

<p>The first argument must be the command name and the remaining arguments are
sent directly as arguments to the command. They're not escaped like with
<tt>Rye::Box</tt> so you can use the asterisk, environment variables,
pipes, and redirects etc. Also note that you can specify single character
switches as symbols and you can separate arguments or put them into a
single String.</p>

<pre>Rye.shell :ls, '*'
Rye.shell :ls, '-l $HOME'
Rye.shell :ls, :l, '$HOME &gt; $TMPDIR/crazy.txt'</pre>

<p>The return value is a <a href="Rye/Rap.html">Rye::Rap</a> object (just like
with <a href="Rye/Box.html">Rye::Box</a>) so you have access to the exit
code and STDERR output:</p>

<pre>ret = Rye.shell :ls, 'nofile'
ret.exit_status      # =&gt; 1
ret.stderr           # =&gt; &quot;sh: nofile: No such file or directory&quot;
ret.class            # =&gt; Rye::Rap</pre>

<h2>Example 8a -- Hopping Firewalls</h2>

<p>When working with machines that are behind another host (assuming that you
have ssh access to the firewall host):</p>

<pre>   rhop = Rye::Hop.new('firewall.lan')
   rbox = Rye::Box.new('filibuster', :via =&gt; rhop)
   rbox.uptime     # =&gt; 20:53  up 1 day,  1:52, 4 users

Or

   rbox = Rye::Box.new('filibuster', :via =&gt; 'firewall.lan')</pre>

<p>The information for the <a href="Rye/Box.html">Rye::Box</a> is then
relative from the position of the firewall.  So, the hostname 'filibuster'
is used from 'firewall.lan'</p>

<h2>Example 8b -- Hopping Firewalls, in groups</h2>

<pre>rset = Rye::Set.new &quot;guarded_few&quot;, :parallel =&gt; true
rhop = Rye::Hop.new &quot;firewall.lan&quot;
rbox1 = Rye::Box.new &quot;192.168.1.10&quot;, :via =&gt; rhop
rbox2 = Rye::Box.new &quot;192.168.1.15&quot;, :via =&gt; rhop
rset.add_boxes rbox1, rbox2
rset.uptime
    # =&gt; [[17:17:44 up 548 days, 13:37, 20 users,  load average: 0.12, 0.07, 0.06], [01:17:49 up 6 days,  1:39,  9 users,  load average: 0.13, 0.09, 0.09]]</pre>

<h2>About Safe-Mode</h2>

<p>In safe-mode:</p>
<ul><li>
<p>You can't use file globs. This means you can't do this:
<tt>rbox.ls('*.rb')</tt>. <tt>~</tt> also doesn't work!</p>
</li><li>
<p>You can't use environment variables as arguments. This means you can't do
this: <tt>rbox.echo('$HOME')</tt>. However, environment variables are
available to the commands you run.</p>
</li><li>
<p>Pipes and operators don't work: <tt>|, &amp;&amp;, &gt;, &lt;, ||, ~</tt>,
etc...</p>
</li><li>
<p>Backticks don't work either: <tt>procs=`ps aux`</tt></p>
</li></ul>

<p>Why? In safe-mode, all command arguments are escaped which turns all
arguments into their literal values.</p>

<p>Using a Ruby interface to execute shell commands is pretty awesome,
particularly to run them on several machines simultaneously. That's a lot
of power and it's potentially very dangerous. That's why <a
href="Rye.html">Rye</a> disables this stuff by default. There's probably a
way to do it safely but it's not obvious yet (to me). If you have any
ideas, I'd love to hear them!</p>

<h2>Command Whitelist</h2>

<p><a href="Rye.html">Rye</a> permits only a limited number of system commands
to be run. This default whitelist is defined in <a
href="http://github.com/delano/rye/blob/master/lib/rye/cmd.rb">Rye::Cmd</a>
but you can add your own commands as you please (see Example 3).</p>

<h2>Dependencies</h2>
<ul><li>
<p><a href="http://www.openssl.org">OpenSSL</a> (The C library)</p>
</li><li>
<p>Ruby Gems:</p>
<ul><li>
<p>net-ssh</p>
</li><li>
<p>net-scp</p>
</li><li>
<p>highline</p>
</li><li>
<p>drydock</p>
</li><li>
<p>sysinfo</p>
</li><li>
<p>storable</p>
</li></ul>
</li></ul>

<h2>Installation</h2>

<p>Via Rubygems, one of:</p>

<pre>$ gem install rye</pre>

<p>or via download:</p>
<ul><li>
<p><a href="http://github.com/delano/rye/tarball/latest">rye-latest.tar.gz</a></p>
</li><li>
<p><a href="http://github.com/delano/rye/zipball/latest">rye-latest.zip</a></p>
</li></ul>

<h2>Known Issues</h2>
<ul><li>
<p><a href="Rye.html">Rye</a> doesn't read the ~/.ssh/config file yet</p>
</li><li>
<p>No support for STDIN for commands.</p>
</li><li>
<p>Limited support for interactive shells.</p>
</li></ul>

<p>If you find one let me know!</p>

<h2>Thanks</h2>
<ul><li>
<p>Kalin Harvey (<a href="http://rely.ca">rely.ca</a>)</p>
</li><li>
<p><a href="http://github.com/adamwiggins/rush">Rush</a> and <a
href="http://github.com/jamis/capistrano/blob/master/lib/capistrano/shell.rb">Capistrano</a>
for the inspiration.</p>
</li><li>
<p>Mike Cline for giving the okay to use the <a href="Rye.html">Rye</a> name.</p>
</li><li>
<p>Justin Case (<a
href="http://github.com/justincase/">github.com/justincase/</a>) for fixes</p>
</li><li>
<p>Vincent Batts (<a href="http://hashbangbash.com/">hashbangbash.com/</a>)
for <a href="Rye/Hop.html">Rye::Hop</a></p>
</li></ul>

<h2>More Info</h2>
<ul><li>
<p><a href="http://github.com/delano/rye">Codes</a></p>
</li><li>
<p><a href="http://delano.github.com/rye">Rdocs</a></p>
</li><li>
<p><a href="http://www.youtube.com/watch?v=_StUVh6ENuw">Inspiration</a></p>
</li></ul>

<h2>Related Projects</h2>
<ul><li>
<p><a href="http://github.com/adamwiggins/rush">Rush</a></p>
</li></ul>

<h2>Credits</h2>
<ul><li>
<p>Delano (@solutious.com)</p>
</li><li>
<p>Escape, Copyright (C) 2006,2007 Tanaka Akira &lt;akr@fsij.org&gt;</p>
</li><li>
<p><a href="Rye/Box.html#method-i-instance_exec">Rye::Box#instance_exec</a>
(for Ruby 1.8) Mauricio Fernandez</p>
</li></ul>

<h2>License</h2>

<p>See: <a href="LICENSE_txt.html">LICENSE.txt</a></p>

  </div>

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>
</body>
</html>

